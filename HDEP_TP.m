

function Hdep  =  HDEP_TP(T,P,y)
% Components are CH4, C2H6, C3H8, C4H10, C5H12, C6H14, C7H16, C8H18,
% C9H20,C10H22
Tc = [190.6 305.3 369.8 425.2 469.7 507.6 540.2 568.7 591.8 617.7]; % K
Pc = [4599000 4872000 4248000 3796000 3370000 3025000 2740000 2490000 2280000 2100000]; % Pa
w = [0.008 0.098 0.152 0.193 0.228 0.251 0.276 0.3 0.326 0.35];

R=8.314;
kij =[0	0.0218	0.0396	0.0541	0.0661	0.0758	0.0839	0.0904	0.0958	0.1002;...
0.0218	0	0.0218	0.0396	0.0541	0.0661	0.0758	0.0839	0.0904	0.0958;...
0.0396	0.0218	0	0.0218	0.0396	0.0541	0.0661	0.0758	0.0839	0.0904;...
0.0541	0.0396	0.0218	0	0.0218	0.0396	0.0541	0.0661	0.0758	0.0839;...
0.0661	0.0541	0.0396	0.0218	0	0.0218	0.0396	0.0541	0.0661	0.0758;...
0.0758	0.0661	0.0541	0.0396	0.0218	0	0.0218	0.0396	0.0541	0.0661;...
0.0839	0.0758	0.0661	0.0541	0.0396	0.0218	0	0.0218	0.0396	0.0541;...
0.0904	0.0839	0.0758	0.0661	0.0541	0.0396	0.0218	0	0.0218	0.0396;...
0.0958	0.0904	0.0839	0.0758	0.0661	0.0541	0.0396	0.0218	0	0.0218;...
0.1002	0.0958	0.0904	0.0839	0.0758	0.0661	0.0541	0.0396	0.0218	0];





% Compute TR parameters for each component
Tr = T ./ Tc;
m = 0.37464 + 1.54226 .* w - 0.26992 .* w .^2;
alpha = (1 + m .* (1 - sqrt(Tr))).^2;
a_i = 0.45724 * (R^2) .* Tc.^2 ./ Pc .* alpha;
b_i = 0.07780 * R .* Tc ./ Pc;
tau =(1+m)./sqrt(alpha)-1;
Ai = a_i * P / (R^2 * T^2);
%Bi = b_i* P / (R * T);

% Mixture parameters
a_mix = 0; teta_mix=0;
for i = 1:10
    for j = 1:10
        a_mix = a_mix + y(i)*y(j)*sqrt(a_i(i)*a_i(j))*(1 - kij(i,j));
        teta_mix=teta_mix+y(i)*y(j)*sqrt(Ai(i)*Ai(j))*(tau(i)+tau(j));
    end
end

b_mix = sum(y .* b_i);

% Define A and B for mixture
A = a_mix * P / (R^2 * T^2);
B = b_mix * P / (R * T);

% Solve PR cubic for Z
coeffs = [1, -(1 - B), A - 3*B^2 - 2*B, -(A*B - B^2 - B^3)];
Z_roots = roots(coeffs);
Z_real = max(real(Z_roots));  

% Compute entropy departure (in J/mol.K)
term1 =  Z_real - 1;
term2 = ((teta_mix+A) / ( sqrt(8) * B)) * log((Z_real + (1 + sqrt(2))*B)/(Z_real + (1 - sqrt(2))*B));
Hdep = (term1 - term2)*R*T;
end
